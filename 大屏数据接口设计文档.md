# 区域老年人健康大数据分析平台 - 数据接口设计文档

## 概述
本文档定义了区域老年人健康大数据分析平台大屏页面所需的统一数据接口。

## API 基础信息
- 基础URL: `http://127.0.0.1:5000/api/dashboard`
- 请求方式: GET
- 认证方式: 需要登录认证（Cookie/Session）

## 统一数据接口

### 接口地址
```
GET /api/dashboard/all
```

### 响应数据结构
```json
{
  "success": true,
  "data": {
    "overview": {
      "total_users": 25600,
      "total_regions": 10,
      "high_risk_users": 5870,
      "avg_risk_score": 0.68,
      "update_time": "2024-01-15 14:30:00"
    },
    "region_users": [
      {
        "name": "成都市",
        "value": 5600
      },
      {
        "name": "绵阳市", 
        "value": 3200
      },
      {
        "name": "宜宾市",
        "value": 2700
      }
    ],
    "age_risk": [
      {
        "age_group": "60-69",
        "low": 320,
        "medium": 480,
        "high": 150
      },
      {
        "age_group": "70-79", 
        "low": 250,
        "medium": 500,
        "high": 260
      },
      {
        "age_group": "80+",
        "low": 100,
        "medium": 240,
        "high": 300
      }
    ],
    "map_data": [
      {
        "name": "成都市",
        "value": 82,
        "high_risk_count": 1280,
        "hypertension_rate": 0.23,
        "diabetes_rate": 0.17,
        "total_users": 5600
      },
      {
        "name": "绵阳市",
        "value": 68,
        "high_risk_count": 720,
        "hypertension_rate": 0.19,
        "diabetes_rate": 0.14,
        "total_users": 3200
      },
      {
        "name": "德阳市",
        "value": 74,
        "high_risk_count": 610,
        "hypertension_rate": 0.21,
        "diabetes_rate": 0.15,
        "total_users": 2900
      }
    ],
    "region_risk": [
      {
        "region": "成都市",
        "low": 1200,
        "medium": 2300,
        "high": 2100
      },
      {
        "region": "绵阳市",
        "low": 800,
        "medium": 1600,
        "high": 1700
      },
      {
        "region": "宜宾市",
        "low": 600,
        "medium": 1200,
        "high": 1400
      }
    ],
    "risk_distribution": [
      {
        "region": "成都市",
        "score": 0.82
      },
      {
        "region": "绵阳市",
        "score": 0.74
      },
      {
        "region": "泸州市",
        "score": 0.69
      }
    ]
  }
}
```

## 数据字段说明

### overview (总览数据)
- `total_users`: 总用户数
- `total_regions`: 覆盖地区数量
- `high_risk_users`: 高风险用户数
- `avg_risk_score`: 平均风险评分 (0-1)
- `update_time`: 数据更新时间

### region_users (各地区用户数分布 - chart_1)
- `name`: 地区名称
- `value`: 该地区用户数量

### age_risk (各年龄段风险人数分布 - chart_2)
- `age_group`: 年龄段
- `low`: 低风险人数
- `medium`: 中风险人数  
- `high`: 高风险人数

### map_data (四川地图健康数据 - chart_map)
- `name`: 地区名称
- `value`: 健康风险评分 (0-100)
- `high_risk_count`: 高风险用户数
- `hypertension_rate`: 高血压患病率 (0-1)
- `diabetes_rate`: 糖尿病患病率 (0-1)
- `total_users`: 该地区总用户数

### region_risk (各地区风险人数分布 - chart_3)
- `region`: 地区名称
- `low`: 低风险人数
- `medium`: 中风险人数
- `high`: 高风险人数

### risk_distribution (风险度评分分布 - chart_4)
- `region`: 地区名称
- `score`: 风险评分 (0-1)

## 错误响应格式

```json
{
  "success": false,
  "error": "错误信息",
  "code": 400
}
```

## 数据更新频率建议

- **实时数据**: 每5分钟更新一次
- **统计数据**: 每小时更新一次
- **历史数据**: 每天更新一次

## 注意事项

1. 所有数值字段应为数字类型，不要使用字符串
2. 百分比数据使用0-1的小数表示
3. 地区名称应与地图GeoJSON文件中的名称保持一致
4. 建议添加数据缓存机制，避免频繁查询数据库
5. 考虑添加数据版本号，便于前端判断是否需要更新

## 后端实现建议

1. **数据库查询优化**: 使用索引和预聚合数据
2. **缓存策略**: 使用Redis缓存热点数据
3. **数据聚合**: 在数据库层面进行数据聚合，减少应用层计算
4. **异步更新**: 使用定时任务异步更新统计数据
5. **监控告警**: 添加数据异常监控和告警机制 